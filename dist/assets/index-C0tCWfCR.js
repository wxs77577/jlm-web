(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))s(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function d(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(a){if(a.ep)return;a.ep=!0;const o=d(a);fetch(a.href,o)}})();const M=["烟","酒","赌","熬","糖","氪","废","色","辣","盐","懒","抖","购","戏","拖"];class p{constructor(i,d,s=0,a=null,o=[]){this.id=i,this.name=d,this.streak=s,this.lastChecked=a,this.checkIns=o}}const r={getHabits(){const e=localStorage.getItem("habits");return e?JSON.parse(e).map(i=>new p(i.id,i.name,i.streak,i.lastChecked,i.checkIns)):[]},saveHabits(e){localStorage.setItem("habits",JSON.stringify(e))},getNotificationTime(){const e=localStorage.getItem("notificationHour"),i=localStorage.getItem("notificationMinute");return{hour:e!==null?parseInt(e):9,minute:i!==null?parseInt(i):0}},saveNotificationTime(e,i){localStorage.setItem("notificationHour",e),localStorage.setItem("notificationMinute",i)}},f={today(){return new Date().toISOString().split("T")[0]},yesterday(){const e=new Date;return e.setDate(e.getDate()-1),e.toISOString().split("T")[0]}},n={habits:[],pendingHabit:null,deleteHabit:null,selectedHour:9,selectedMinute:0},t={habitList:document.getElementById("habitList"),habitCount:document.getElementById("habitCount"),addBtn:document.getElementById("addBtn"),addModal:document.getElementById("addModal"),closeAddModal:document.getElementById("closeAddModal"),tagsContainer:document.getElementById("tagsContainer"),customInput:document.getElementById("customInput"),customAddBtn:document.getElementById("customAddBtn"),confirmModal:document.getElementById("confirmModal"),confirmText:document.getElementById("confirmText"),confirmOk:document.getElementById("confirmOk"),confirmCancel:document.getElementById("confirmCancel"),deleteModal:document.getElementById("deleteModal"),deleteText:document.getElementById("deleteText"),deleteOk:document.getElementById("deleteOk"),deleteCancel:document.getElementById("deleteCancel"),notificationBtn:document.getElementById("notificationBtn"),notificationTime:document.getElementById("notificationTime"),timeModal:document.getElementById("timeModal"),hourWheel:document.getElementById("hourWheel"),minuteWheel:document.getElementById("minuteWheel"),timeSaveBtn:document.getElementById("timeSaveBtn")};function u(){var i;if(t.habitCount.textContent=n.habits.length,n.habits.length===0){t.habitList.innerHTML=`
      <div class="empty-state" id="emptyState">
        <div class="empty-state-text">开启第一项戒断</div>
        <div class="empty-state-sub">Let's Get Started</div>
      </div>
    `,(i=document.getElementById("emptyState"))==null||i.addEventListener("click",()=>v("add"));return}const e=f.today();t.habitList.innerHTML=`
    <div class="habit-list">
      ${n.habits.map(d=>{const s=d.lastChecked===e;return`
          <div class="habit-card ${s?"checked":""}" data-id="${d.id}">
            <div class="habit-header">
              <div>
                <div class="habit-name">${d.name}</div>
                <div class="habit-status">
                  <div class="status-dot ${s?"checked":""}"></div>
                  <div class="status-text">${s?"Checked":"Ready"}</div>
                </div>
              </div>
              <div class="habit-streak">
                <div class="streak-count">${d.streak}</div>
                <div class="streak-label">Days</div>
              </div>
            </div>
          </div>
        `}).join("")}
    </div>
  `,document.querySelectorAll(".habit-card").forEach(d=>{const s=d.dataset.id,a=n.habits.find(m=>m.id===s),o=a.lastChecked===e;d.addEventListener("click",()=>{o||(n.pendingHabit=a,I(a))}),d.addEventListener("contextmenu",m=>{m.preventDefault(),n.deleteHabit=a,b(a)});let l;d.addEventListener("touchstart",()=>{l=setTimeout(()=>{n.deleteHabit=a,b(a)},500)}),d.addEventListener("touchend",()=>clearTimeout(l)),d.addEventListener("touchmove",()=>clearTimeout(l))})}function k(){t.tagsContainer.innerHTML=M.map(e=>`<button class="tag-btn" data-tag="${e}">${e}</button>`).join(""),document.querySelectorAll(".tag-btn").forEach(e=>{e.addEventListener("click",()=>g(e.dataset.tag))})}function h(){t.hourWheel.innerHTML=Array.from({length:24},(e,i)=>`<div class="time-option ${i===n.selectedHour?"selected":""}" data-value="${i}">${String(i).padStart(2,"0")}</div>`).join(""),t.minuteWheel.innerHTML=Array.from({length:60},(e,i)=>`<div class="time-option ${i===n.selectedMinute?"selected":""}" data-value="${i}">${String(i).padStart(2,"0")}</div>`).join(""),document.querySelectorAll("#hourWheel .time-option").forEach(e=>{e.addEventListener("click",()=>{n.selectedHour=parseInt(e.dataset.value),h()})}),document.querySelectorAll("#minuteWheel .time-option").forEach(e=>{e.addEventListener("click",()=>{n.selectedMinute=parseInt(e.dataset.value),h()})})}function v(e){e==="add"?(t.addModal.classList.add("show"),t.customInput.value=""):e==="time"&&(h(),t.timeModal.classList.add("show"))}function c(e){e.classList.remove("show")}function I(e){t.confirmText.innerHTML=`摸着良心说，<br>今天真的戒【${e.name}】了吗？`,t.confirmModal.classList.add("show")}function b(e){t.deleteText.textContent=`确定要删除「${e.name}」吗？`,t.deleteModal.classList.add("show")}function g(e){const i=e.trim();if(!i||n.habits.some(s=>s.name===i))return;const d=new p(Date.now().toString(),i,0,null,[]);n.habits.push(d),r.saveHabits(n.habits),u(),c(t.addModal)}function L(){if(!n.pendingHabit)return;const e=n.pendingHabit,i=f.today(),d=f.yesterday();if(e.lastChecked===i)return;e.checkIns.includes(i)||e.checkIns.push(i);const s=e.lastChecked===d||e.lastChecked===null?e.streak+1:1;e.streak=s,e.lastChecked=i,r.saveHabits(n.habits),u(),c(t.confirmModal),n.pendingHabit=null}function H(){n.deleteHabit&&(n.habits=n.habits.filter(e=>e.id!==n.deleteHabit.id),r.saveHabits(n.habits),u(),c(t.deleteModal),n.deleteHabit=null)}function E(){const{hour:e,minute:i}=r.getNotificationTime();t.notificationTime.textContent=`${String(e).padStart(2,"0")}:${String(i).padStart(2,"0")}`,n.selectedHour=e,n.selectedMinute=i}function B(){r.saveNotificationTime(n.selectedHour,n.selectedMinute),E(),"Notification"in window&&Notification.permission==="granted"?y():"Notification"in window&&Notification.permission!=="denied"&&Notification.requestPermission().then(e=>{e==="granted"&&y()}),c(t.timeModal)}function y(e,i){"serviceWorker"in navigator&&navigator.serviceWorker.register("/sw.js").catch(()=>{})}function S(){t.addBtn.addEventListener("click",()=>v("add")),t.closeAddModal.addEventListener("click",()=>c(t.addModal)),t.addModal.addEventListener("click",e=>{e.target===t.addModal&&c(t.addModal)}),t.customAddBtn.addEventListener("click",()=>g(t.customInput.value)),t.customInput.addEventListener("keypress",e=>{e.key==="Enter"&&g(t.customInput.value)}),t.confirmOk.addEventListener("click",L),t.confirmCancel.addEventListener("click",()=>{c(t.confirmModal),n.pendingHabit=null}),t.confirmModal.addEventListener("click",e=>{e.target===t.confirmModal&&(c(t.confirmModal),n.pendingHabit=null)}),t.deleteOk.addEventListener("click",H),t.deleteCancel.addEventListener("click",()=>{c(t.deleteModal),n.deleteHabit=null}),t.deleteModal.addEventListener("click",e=>{e.target===t.deleteModal&&(c(t.deleteModal),n.deleteHabit=null)}),t.notificationBtn.addEventListener("click",()=>v("time")),t.timeSaveBtn.addEventListener("click",B),t.timeModal.addEventListener("click",e=>{e.target===t.timeModal&&c(t.timeModal)})}function T(){n.habits=r.getHabits(),E(),k(),u(),S(),"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission()}T();
